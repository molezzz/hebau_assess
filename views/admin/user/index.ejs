<% layout('../layout') -%>
<% script('/javascripts/angular/ui-bootstrap.js') -%>

<div class="row" ng-controller="UsersCtrl">
  <div class="navbar navbar-default">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">员工管理</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse navbar-ex1-collapse">
      <div class="navbar-left">
        <button type="button" class="btn btn-default navbar-btn" ng-click="newUser()">添加</button>
        <button type="button" class="btn btn-warning navbar-btn">删除</button>
      </div>
      <form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="输入人名">
        </div>
        <button type="submit" class="btn btn-default">搜索</button>
      </form>

    </div><!-- /.navbar-collapse -->
  </div>
</div>

<div class="row" ng-controller="UsersCtrl">
  <div class="col-md-10">
    <div class="panel">
      <table class="table table-striped table-hover table-condensed">
        <thead>
          <tr>
            <th></th>
            <th>#</th>
            <th>姓名</th>
            <th>所属部门</th>
            <th>E-MAIL</th>
            <th>手机号</th>
            <th>创建时间</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td></td>
            <td>#</td>
            <td>姓名</td>
            <td>所属部门</td>
            <td>E-MAIL</td>
            <td>手机号</td>
            <td></td>
            <td></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="col-md-2">
    <div class="panel panel-default">
      <div class="panel-heading">
        按部门检索
      </div>

      <div class="panel-body">
        <ul class="nav nav-stacked nav-pills">
          <li>
            <h5>教学机构</h5>
            <ul class="nav nav-stacked nav-pills">
              <li><a href="#">XX实验室</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </div>

</div><!-- row -->
<script type="text/ng-template" id="newUserDialog.tpl">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" ng-click="close()">&times;</button>
        <h4 class="modal-title">{{title}}</h4>
      </div>
      <div class="modal-body">
        <form name="user_form" role="form">
          <div class="form-group">
            <label>姓名</label>
            <input type="text" name="name" ng-model="user.name" class="form-control" required placeholder="填写姓名">
            <p ng-show="post && user_form.name.$error.required" class="help-block">
              <span class="label label-danger">姓名 不能为空！</span>
            </p>
          </div>
          <div class="form-group">
            <label>E-mail</label>
            <input type="email" name="email" ng-model="user.email" class="form-control" required placeholder="e-mail">
            <p ng-show="post && user_form.email.$error.required" class="help-block">
              <span class="label label-danger">E-mail 地址不能为空！</span>
            </p>
            <p ng-show="post && user_form.email.$error.email" class="help-block">
              <span class="label label-danger">email 格式不正确！</span>
            </p>
          </div>
          <div class="form-group">
            <label>手机号 <span class="label label-default">选填</span></label>
            <input type="text" name="phone" ng-model="user.phone" class="form-control" ng-pattern="/^1[3|4|5|8][0-9]\d{8}$/" placeholder="手机号">
            <p class="help-block">
              <span ng-show="post && user_form.phone.$error.pattern" class="label label-danger">手机号  格式不正确！</span>
            </p>
          </div>
          <div class="form-group">
            <label>所属机构</label>
            <input type="text" name="department" ng-model="user.department"  class="form-control" required placeholder="number">
            <p ng-show="post && user_form.department.$error.required" class="help-block">
              <span class="label label-danger">所属机构 不能为空！</span>
            </p>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" ng-click="close()">关闭</button>
        <button type="button" class="btn btn-primary" ng-click="submit()">保存</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</script>
<script type="text/javascript">
(function($){
var app = angular.module('heba.admin.users', ['ui.bootstrap'], angular.noop);
app.controller('UsersCtrl', ['$scope', '$dialog', function($scope, $dialog){
  var opts = {
    backdrop: true,
    keyboard: true,
    backdropClick: false,
    dialogFade: true,
    dialogClass: 'modal',
    templateUrl: 'newUserDialog.tpl',
    controller: 'NewUserCtrl',
    resolve: { data: function(){
      return {};
    }}
  };

  $scope.newUser = function(){
    var data = {
      title: '添加员工'
    }
    var d = $dialog.dialog($.extend({},opts,{ resolve: {data: function(){ return data; }} }));
    d.open();
  }

}]);
app.controller('NewUserCtrl',['$scope', 'dialog', 'data', '$http', function($scope, dialog, data, $http){
  $scope.title = data.title || '';
  $scope.user = $.extend({}, data.user);
  $scope.post = false;

  $scope.close = function(){
    dialog.close();
  }

  $scope.submit = function(){
    $scope.post = true;
    if($scope.user_form.$invalid){ return false;}
    $http.post('/admin/users/', { user: $scope.user})
         .success(function(data, status, headers, config) {

         })
         .error(function(data, status, headers, config) {

         });
  }

}]);
angular.bootstrap(document.documentElement, ['heba.admin.users']);
})(jQuery);
</script>